(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,4945,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},54898,e=>{"use strict";var t=e.i(88614),r=e.i(32508),a=e.i(54968),s=e.i(61116),o=e.i(67236),n=e.i(97658),l=e.i(92874),i=e.i(30214),u=e.i(85572),d=e.i(20877),c=e.i(41347),h=e.i(94466),p=e.i(32872),f=e.i(43837),m=e.i(92997);let g=({jobId:e,namespace:a="default"})=>{let[g,b]=(0,s.useState)(!1),{formData:k,initialJob:v,isLoading:y,isSaving:x,isLoadingNamespaces:j,error:G,success:C,namespaces:N,handleInputChange:w,handleGroupInputChange:S,handleSelectChange:V,handleGroupCheckboxChange:$,handleEnvVarChange:E,addEnvVar:A,removeEnvVar:P,handlePortChange:T,addPort:J,removePort:I,handleHealthCheckChange:q,addTaskGroup:F,removeTaskGroup:R,handleSubmit:B}=function(e,t="default"){let a=(0,r.useRouter)(),{token:d,nomadAddr:c}=(0,o.useAuth)(),{addToast:h}=(0,i.useToast)(),[p,f]=(0,s.useState)(!0),[m,g]=(0,s.useState)(!1),[b,k]=(0,s.useState)(null),[v,y]=(0,s.useState)(null),[x,j]=(0,s.useState)(["default"]),[G,C]=(0,s.useState)(!0),[N,w]=(0,s.useState)(null),[S,V]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{if(!d||!c)return C(!1);try{let e=(0,n.createNomadClient)(c,d),t=await e.getNamespaces();if(t&&Array.isArray(t)){let e=t.map(e=>e.Name);j(e.length>0?e:["default"])}}catch(e){console.error("Failed to fetch namespaces:",e),j(["default"])}finally{C(!1)}})()},[d,c]);let $=(0,s.useCallback)(async()=>{if(!d||!c||!e){k("Authentication or job ID required"),f(!1);return}f(!0);try{let r=(0,n.createNomadClient)(c,d),a=await r.getJob(e,t);w(a);let s=(0,l.convertJobToFormData)(a);s.taskGroups=s.taskGroups.map(e=>({...e,envVars:e.envVars||[]})),V(s),k(null)}catch(e){console.error("Failed to fetch job details:",e),k("object"==typeof e&&null!==e&&"message"in e?e.message:"Failed to load job details. Please check your connection and try again."),h("Failed to load job details","error")}finally{f(!1)}},[d,c,e,t,h]);(0,s.useEffect)(()=>{$()},[$]);let E=e=>{if(!S)return;let t=[...S.taskGroups],r=t[e].envVars||[];t[e]={...t[e],envVars:[...r,{key:"",value:""}]},V({...S,taskGroups:t})};(0,s.useEffect)(()=>{S&&S.taskGroups.forEach((e,t)=>{e.envVars&&0!==e.envVars.length||E(t)})},[S]);let A=async r=>{r.preventDefault(),k(null),y(null),g(!0);try{if(!d||!c||!S||!N)throw Error("Authentication required or form data missing");for(let e=0;e<S.taskGroups.length;e++){let t=S.taskGroups[e];if(!t.name.trim())throw Error(`Group ${e+1} name is required`);if(!t.image.trim())throw Error(`Image for group ${e+1} is required`);if(t.usePrivateRegistry){if(!t.dockerAuth?.username)throw Error(`Username is required for private registry in group ${e+1}`);if(!t.dockerAuth?.password)throw Error(`Password is required for private registry in group ${e+1}`)}if(t.envVars&&(t.envVars=t.envVars.filter(e=>""!==e.key.trim()||""!==e.value.trim())),t.enableNetwork&&t.ports.length>0)for(let r=0;r<t.ports.length;r++){let a=t.ports[r];if(!a.label)throw Error(`Port label is required for port ${r+1} in group ${e+1}`);if(a.static&&(!a.value||a.value<=0||a.value>65535))throw Error(`Valid port value (1-65535) is required for static port ${r+1} in group ${e+1}`)}}let r=(0,l.updateJobSpec)(N,S);console.log("Updated job spec:",JSON.stringify(r,null,2));let s=(0,n.createNomadClient)(c,d);await s.updateJob(r),y(`Job "${S.name}" updated successfully!`),setTimeout(()=>{a.push(`/jobs/${e}?namespace=${t}`)},2e3)}catch(e){console.error("Failed to update job:",e),k("object"==typeof e&&null!==e&&"message"in e?e.message:"Failed to update job. Please check your inputs and try again."),h("Failed to update job","error")}finally{g(!1)}};return{formData:S,initialJob:N,isLoading:p,isSaving:m,isLoadingNamespaces:G,error:b,success:v,namespaces:x,handleInputChange:e=>{if(!S)return;let{name:t,value:r,type:a}=e.target,s="number"===a?Number(r):r;"datacenters"===t?V({...S,datacenters:r.split(",").map(e=>e.trim())}):V({...S,[t]:s})},handleGroupInputChange:(e,t)=>{if(!S)return;let{name:r,value:a,type:s}=t.target,o="number"===s?Number(a):a,n=[...S.taskGroups],l=r.split(".");if(1===l.length)n[e]={...n[e],[r]:o};else if(2===l.length&&"resources"===l[0]){let t=l[1];n[e]={...n[e],resources:{...n[e].resources,[t]:parseInt(a,10)}}}else if(2===l.length&&"dockerAuth"===l[0]){let t=l[1];n[e]={...n[e],dockerAuth:{...n[e].dockerAuth,[t]:a}}}else if(2===l.length&&"healthCheck"===l[0]){let t=l[1];n[e]={...n[e],healthCheck:{...n[e].healthCheck,[t]:"number"===s?parseInt(a,10):a}}}V({...S,taskGroups:n})},handleSelectChange:(e,t)=>{if(!S)return;let{name:r,value:a}=t.target,s=[...S.taskGroups];s[e]={...s[e],[r]:a},V({...S,taskGroups:s})},handleGroupCheckboxChange:(e,t)=>{if(!S)return;let{name:r,checked:a}=t.target,s=[...S.taskGroups];s[e]={...s[e],[r]:a},V({...S,taskGroups:s})},handleEnvVarChange:(e,t,r,a)=>{if(!S)return;let s=[...S.taskGroups],o=[...s[e].envVars||[]];o[t]||(o[t]={key:"",value:""}),o[t]={...o[t],[r]:a},s[e]={...s[e],envVars:o},V({...S,taskGroups:s})},addEnvVar:E,removeEnvVar:(e,t)=>{if(!S)return;let r=[...S.taskGroups],a=[...r[e].envVars||[]];a.length<=1?r[e]={...r[e],envVars:[]}:(a.splice(t,1),r[e]={...r[e],envVars:a}),V({...S,taskGroups:r})},handlePortChange:(e,t,r,a)=>{if(!S)return;let s=[...S.taskGroups],o=[...s[e].ports];if("static"===r){let e="true"===a;o[t]={...o[t],[r]:e},e&&!o[t].value&&(o[t].value=8080+t)}else"label"===r?o[t]={...o[t],[r]:a}:o[t]={...o[t],[r]:parseInt(a,10)||0};s[e]={...s[e],ports:o},V({...S,taskGroups:s})},addPort:e=>{if(!S)return;let t=[...S.taskGroups];t[e]={...t[e],ports:[...t[e].ports,{label:"",value:0,to:8080,static:!1}]},V({...S,taskGroups:t})},removePort:(e,t)=>{if(!S)return;let r=[...S.taskGroups];if(r[e].ports.length<=1){r[e]={...r[e],ports:[{label:"",value:0,to:0,static:!1}]};return}let a=[...r[e].ports];a.splice(t,1),r[e]={...r[e],ports:a},V({...S,taskGroups:r})},handleHealthCheckChange:(e,t,r)=>{if(!S)return;let a=[...S.taskGroups];a[e].healthCheck||(a[e].healthCheck={...u.defaultTaskGroupData.healthCheck}),"type"===t?a[e]={...a[e],healthCheck:{...a[e].healthCheck,[t]:r}}:a[e]={...a[e],healthCheck:{...a[e].healthCheck,[t]:"string"==typeof r?r:parseInt(String(r),10)||0}},V({...S,taskGroups:a})},addTaskGroup:()=>{if(!S)return;let e={...u.defaultTaskGroupData,name:`${S.name?S.name+"-":""}group-${S.taskGroups.length+1}`};V({...S,taskGroups:[...S.taskGroups,e]})},removeTaskGroup:e=>{if(!S||S.taskGroups.length<=1)return;let t=[...S.taskGroups];t.splice(e,1),V({...S,taskGroups:t})},handleSubmit:A}}(e,a);return y?(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):G&&!k?(0,t.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[(0,t.jsx)("strong",{className:"font-bold",children:"Error: "}),(0,t.jsx)("span",{className:"block sm:inline",children:G}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(d.default,{href:`/jobs/${e}?namespace=${a}`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Back to Job"})})]}):k?(0,t.jsxs)(c.default,{title:`Edit Job: ${k.name}`,error:G||void 0,success:C||void 0,isLoading:x,onSubmit:B,submitButtonText:"Save Changes",cancelHref:`/jobs/${e}?namespace=${a}`,children:[(0,t.jsx)(m.default,{id:"name",name:"name",label:"Job Name",type:"text",value:k.name,onChange:w,disabled:!0,helpText:"Job name cannot be changed after creation.",className:"bg-gray-100 cursor-not-allowed"}),(0,t.jsx)(m.default,{id:"namespace",name:"namespace",label:"Namespace",type:"text",value:k.namespace,onChange:w,disabled:!0,className:"bg-gray-100 cursor-not-allowed"}),(0,t.jsx)(h.default,{taskGroups:k.taskGroups,jobName:k.name,namespace:k.namespace,isLoading:x,onAddTaskGroup:F,onGroupInputChange:S,onGroupCheckboxChange:$,onEnvVarChange:E,onAddEnvVar:A,onRemoveEnvVar:P,onPortChange:T,onAddPort:J,onRemovePort:I,onHealthCheckChange:q,onRemoveTaskGroup:R}),(0,t.jsx)(f.default,{showAdvancedSettings:g,setShowAdvancedSettings:b}),g&&(0,t.jsx)(p.default,{datacenters:k.datacenters,onInputChange:w,isLoading:x})]}):(0,t.jsxs)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative",role:"alert",children:[(0,t.jsx)("span",{className:"block sm:inline",children:"No job data available."}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(d.default,{href:"/jobs",className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Back to Jobs"})})]})};function b(){let e=(0,r.useParams)(),s=(0,r.useSearchParams)(),o=e.id,n=s.get("namespace")||"default";return(0,t.jsx)(a.default,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Edit Job"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"Update job configuration"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(d.default,{href:`/jobs/${o}?namespace=${n}`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Back to Job"})})]}),(0,t.jsx)(g,{jobId:o,namespace:n})]})})}e.s(["default",()=>b],54898)}]);